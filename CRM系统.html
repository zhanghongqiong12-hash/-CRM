<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë∑®Â¢ÉÁîµÂïÜÁªèÈîÄÂïÜ CRM Á≥ªÁªü</title>
    
    <!-- ÂºïÂÖ• Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ÂºïÂÖ• React Âíå ReactDOM (ÈîÅÂÆöÁâàÊú¨ 18.2.0) -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- ÂºïÂÖ• Prop-types (Recharts ‰æùËµñ) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>

    <!-- ÂºïÂÖ• Recharts (ÈîÅÂÆöÁâàÊú¨ 2.12.7) -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- ÂºïÂÖ• Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Ëá™ÂÆö‰πâÊ†∑ÂºèÂä®Áîª -->
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideInUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes slideInRight {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes scaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .animate-slide-in-up { animation: slideInUp 0.5s ease-out; }
        .animate-slide-in-right { animation: slideInRight 0.3s ease-out; }
        .animate-scale-in { animation: scaleIn 0.2s ease-out; }
        
        /* ÊªöÂä®Êù°ÁæéÂåñ */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 font-sans antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        // Á°Æ‰øù Recharts Â∑≤Âä†ËΩΩÔºåÂ¶ÇÊûúÊú™Âä†ËΩΩÂàôÊèê‰æõÁ©∫ÂØπË±°ÈÅøÂÖçÊä•Èîô
        const RechartsObj = window.Recharts || {};
        const { 
            LineChart, Line, BarChart, Bar, PieChart, Pie, AreaChart, Area,
            XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend, Cell, ComposedChart
        } = RechartsObj;

        // --- Icons (SVG Components) ---
        const IconBase = ({ size = 24, className = "", children }) => (
            <svg 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const LayoutDashboard = (props) => <IconBase {...props}><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></IconBase>;
        const Users = (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>;
        const ShoppingCart = (props) => <IconBase {...props}><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></IconBase>;
        const Package = (props) => <IconBase {...props}><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22v-9"/></IconBase>;
        const BarChart3 = (props) => <IconBase {...props}><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></IconBase>;
        const Wallet = (props) => <IconBase {...props}><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></IconBase>;
        const Settings = (props) => <IconBase {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconBase>;
        const Bell = (props) => <IconBase {...props}><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></IconBase>;
        const Search = (props) => <IconBase {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>;
        const Plus = (props) => <IconBase {...props}><path d="M5 12h14"/><path d="M12 5v14"/></IconBase>;
        const Filter = (props) => <IconBase {...props}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></IconBase>;
        const MoreHorizontal = (props) => <IconBase {...props}><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></IconBase>;
        const CheckCircle = (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>;
        const AlertCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>;
        const Truck = (props) => <IconBase {...props}><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><path d="M15 18H9"/><path d="M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14"/><circle cx="17" cy="18" r="2"/><circle cx="7" cy="18" r="2"/></IconBase>;
        const MapPin = (props) => <IconBase {...props}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></IconBase>;
        const FileText = (props) => <IconBase {...props}><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></IconBase>;
        const ChevronDown = (props) => <IconBase {...props}><path d="m6 9 6 6 6-6"/></IconBase>;
        const Globe = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></IconBase>;
        const Store = (props) => <IconBase {...props}><path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"/><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"/><path d="M2 7h20"/><path d="M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7"/></IconBase>;
        const ShieldCheck = (props) => <IconBase {...props}><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/><path d="m9 12 2 2 4-4"/></IconBase>;
        const Sparkles = (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 5H5"/><path d="M19 19v-4"/><path d="M15 17h4"/></IconBase>;
        const X = (props) => <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>;
        const Loader2 = (props) => <IconBase {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></IconBase>;
        const Send = (props) => <IconBase {...props}><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></IconBase>;
        const RefreshCw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>;
        const Languages = (props) => <IconBase {...props}><path d="m5 8 6 6"/><path d="m4 14 6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/><path d="m22 22-5-10-5 10"/><path d="M14 18h6"/></IconBase>;
        const TrendingUp = (props) => <IconBase {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></IconBase>;
        const TrendingDown = (props) => <IconBase {...props}><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></IconBase>;
        const AlertTriangle = (props) => <IconBase {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></IconBase>;
        const List = (props) => <IconBase {...props}><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></IconBase>;
        const Database = (props) => <IconBase {...props}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></IconBase>;

        // --- Gemini API Configuration ---
        const apiKey = ""; // ÂÆûÈôÖ‰ΩøÁî®Êó∂ÔºåËØ∑Âú®ËøôÈáåÂ°´ÂÖ•ÊàñÊ≥®ÂÖ• API Key

        const callGemini = async (prompt) => {
            try {
                if (!apiKey) {
                    await new Promise(r => setTimeout(r, 1500));
                    return "ÊºîÁ§∫Ê®°ÂºèÔºöGemini API Key Êú™ÈÖçÁΩÆ„ÄÇÂú®ÂÆûÈôÖÁ≥ªÁªü‰∏≠ÔºåËøôÈáå‰ºöËøîÂõû AI ÁîüÊàêÁöÑÂª∫ËÆÆ„ÄÇ\n\n(Demo: API Key missing. This would be AI generated content.)";
                }
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    }
                );
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "Êó†Ê≥ïÁîüÊàêÂÜÖÂÆπÔºåËØ∑Á®çÂêéÂÜçËØï„ÄÇ";
            } catch (error) {
                console.error("Gemini API Call Failed:", error);
                return "AI ÊúçÂä°ÊöÇÊó∂‰∏çÂèØÁî®ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËÆæÁΩÆ„ÄÇ";
            }
        };

        // --- MOCK DATA FOR NEW DASHBOARD ---
        const MOCK_GMV_TREND = [
            { name: 'Jan', gmv: 4000, shipment: 2400 },
            { name: 'Feb', gmv: 3000, shipment: 1398 },
            { name: 'Mar', gmv: 5000, shipment: 3800 },
            { name: 'Apr', gmv: 4780, shipment: 3908 },
            { name: 'May', gmv: 5890, shipment: 4800 },
            { name: 'Jun', gmv: 6390, shipment: 5800 },
            { name: 'Jul', gmv: 7490, shipment: 6300 },
        ];

        const MOCK_REGIONAL_DATA = [
            { name: 'Âæ∑ÂõΩ', value: 45000, order: 120 },
            { name: 'Êó•Êú¨', value: 32000, order: 98 },
            { name: 'ÁæéÂõΩ', value: 28000, order: 75 },
            { name: 'Ëã±ÂõΩ', value: 21000, order: 60 },
            { name: 'Êæ≥Ê¥≤', value: 15000, order: 40 },
        ];

        const MOCK_LIFECYCLE_DATA = [
            { name: 'Á∫øÁ¥¢ (Leads)', value: 100 },
            { name: 'Â∑≤ÂÆ°Ê†∏ (Audited)', value: 80 },
            { name: 'È¶ñÂçï (First Order)', value: 60 },
            { name: 'Ê¥ªË∑É (Active)', value: 45 },
            { name: 'ÊµÅÂ§± (Churn)', value: 10 },
        ];

        const MOCK_INVENTORY_KPI = [
            { name: 'CN ‰ªì (Shenzhen)', value: 4000, color: '#3b82f6' },
            { name: 'US ‰ªì (LA)', value: 1200, color: '#8b5cf6' },
            { name: 'EU ‰ªì (Hamburg)', value: 1800, color: '#10b981' },
        ];

        const MOCK_NOTIFICATIONS = [
            { type: 'audit', title: '3ÂÆ∂Êñ∞ÁªèÈîÄÂïÜÂæÖÂÆ°Ê†∏', time: '10m', priority: 'high' },
            { type: 'contract', title: '5‰ªΩÂêàÂêåÂç≥Â∞ÜÂà∞Êúü', time: '1h', priority: 'medium' },
            { type: 'stock', title: 'SKU-001 Â∫ìÂ≠ò‰∏çË∂≥È¢ÑË≠¶', time: '2h', priority: 'high' },
            { type: 'finance', title: 'ÁªèÈîÄÂïÜ EuroStyle ÈÄæÊúüÂõûÊ¨æ', time: '1d', priority: 'high' },
        ];

        // --- Translations ---
        const TRANSLATIONS = {
            zh: {
                // Sidebar
                dashboard: 'ÂÖ®ÊôØÁúãÊùø',
                dealers: 'ÁªèÈîÄÂïÜÁÆ°ÁêÜ',
                orders: 'ÈááË¥≠‰∏éËÆ¢Âçï',
                products: 'ÂïÜÂìÅ‰∏éÂ∫ìÂ≠ò',
                finance: 'ÂØπË¥¶‰∏éÁªìÁÆó',
                analysis: 'ÈîÄÂîÆÂàÜÊûê',
                settings: 'Á≥ªÁªüËÆæÁΩÆ',
                adminUser: 'ÁÆ°ÁêÜÂëò',
                globalManager: 'ÂÖ®ÁêÉ‰∏öÂä°ÁªèÁêÜ',
                searchPlaceholder: 'ÂÖ®Â±ÄÊêúÁ¥¢ (ËÆ¢Âçï/ÂÆ¢Êà∑/SKU)...',
                
                // Dashboard Tabs
                tab_overview: 'ÂÖ®ÊôØÁúãÊùø (Overview)',
                tab_supply: '‰æõÂ∫îÈìæ (Supply Chain)',
                tab_dealer: 'ÁªèÈîÄÂïÜËøêËê• (Dealer Ops)',
                tab_risk: 'È£éÊéß‰∏éË¥¢Âä° (Risk & Finance)',

                // Overview
                gmv_trend: 'GMV & Âá∫Ë¥ßË∂ãÂäø',
                regional_map: 'Âå∫ÂüüÈîÄÂîÆÂàÜÂ∏É (Top 5)',
                top_dealers: 'ÁªèÈîÄÂïÜÈááË¥≠ÊéíË°åÊ¶ú',
                notifications: 'Ê∂àÊÅØ‰∏≠ÂøÉ & ÈáçË¶ÅÊèêÈÜí',
                activeDealers: 'Ê¥ªË∑ÉÁªèÈîÄÂïÜ',
                dormantDealers: 'Â≠òÈáèÁªèÈîÄÂïÜ',
                
                // Supply Chain
                inventory_status: 'ÂêÑ‰ªìÂèØÂîÆÂ∫ìÂ≠òÂàÜÂ∏É',
                order_funnel: 'ËÆ¢ÂçïÂ§ÑÁêÜÊºèÊñó',
                logistics_anomaly: '‰æõÂ∫îÈìæÂºÇÂ∏∏ÊèêÈÜí',
                stock_turnover: 'Êµ∑Â§ñ‰ªìÂë®ËΩ¨Â§©Êï∞',
                
                // Dealer Ops
                lifecycle_funnel: 'ÁªèÈîÄÂïÜÁîüÂëΩÂë®ÊúüÊºèÊñó',
                new_product_reach: 'Êñ∞ÂìÅËß¶ËææÊÉÖÂÜµ',
                sales_upload: 'ÈîÄÈáè‰∏äÊä•ÁõëÊéß',
                channel_mix: 'Ê∏†ÈÅìÈîÄÂîÆÂç†ÊØî (Á∫ø‰∏ä vs Á∫ø‰∏ã)',
                
                // Risk & Finance
                finance_overview: 'ÂõûÊ¨æ‰∏éËµÑÈáëÊÄªËßà',
                rebate_progress: 'ËøîÁÇπ‰∏éÊøÄÂä±ËøõÂ∫¶',
                sku_risk: 'ÊªûÈîÄ SKU È¢ÑË≠¶ (Top 5)',
                compliance_alert: '‰∏≤Ë¥ß‰∏éÂêàËßÑÈ£éÈô©',

                // Common Labels
                gmv: 'GMV (‰∫§ÊòìÈ¢ù)',
                shipment: 'Âá∫Ë¥ßÈáè',
                amount: 'ÈáëÈ¢ù',
                count: 'Êï∞Èáè',
                view_detail: 'Êü•ÁúãËØ¶ÊÉÖ',
                
                // Data Enums
                Retailer: 'Èõ∂ÂîÆÂïÜ',
                Distributor: 'ÂàÜÈîÄÂïÜ',
                'Online Seller': 'ÁîµÂïÜÂçñÂÆ∂',
                Wholesaler: 'ÊâπÂèëÂïÜ',
                Active: 'Ê≠£Â∏∏',
                'Pending Audit': 'ÂæÖÂÆ°Ê†∏',
                Low: '‰Ωé',
                Medium: '‰∏≠',
                High: 'È´ò',
                VIP: 'VIP',
                KA: 'KA',
                Normal: 'ÊôÆÈÄö',
                
                // AI
                aiEmailTitle: '‚ú® AI Êô∫ËÉΩÈÇÆ‰ª∂Ëµ∑ËçâÂä©Êâã',
                aiAnalysisTitle: '‚ú® Êô∫ËÉΩÂ∫ìÂ≠ò‰∏éË°•Ë¥ßÂàÜÊûê',
                thinking: 'Gemini Ê≠£Âú®ÊÄùËÄÉ‰∏≠...',
                close: 'ÂÖ≥Èó≠',
                rewrite: 'ÈáçÂÜô',
                confirmCopy: 'Á°ÆËÆ§Âπ∂Â§çÂà∂',
                email_new: 'Êñ∞ÂìÅÊé®Ëçê',
                email_pay: 'ÂÇ¨‰ªòÊèêÈÜí',
                email_greet: 'ËäÇÊó•ÈóÆÂÄô'
            },
            en: {
                dashboard: 'Dashboard',
                dealers: 'Dealers',
                orders: 'Orders',
                products: 'Products',
                finance: 'Finance',
                analysis: 'Analysis',
                settings: 'Settings',
                adminUser: 'Admin',
                globalManager: 'Global Manager',
                searchPlaceholder: 'Search...',
                
                tab_overview: 'Overview',
                tab_supply: 'Supply Chain',
                tab_dealer: 'Dealer Ops',
                tab_risk: 'Risk & Finance',

                gmv_trend: 'GMV & Shipment Trend',
                regional_map: 'Regional Sales Distribution',
                top_dealers: 'Top Dealers Ranking',
                notifications: 'Notification Center',
                activeDealers: 'Active Dealers',
                dormantDealers: 'Stock Dealers',
                
                inventory_status: 'Inventory Distribution',
                order_funnel: 'Order Processing Status',
                logistics_anomaly: 'Logistics Anomalies',
                stock_turnover: 'Warehouse Turnover Days',
                
                lifecycle_funnel: 'Dealer Lifecycle Funnel',
                new_product_reach: 'New Product Reach',
                sales_upload: 'Sales Data Upload',
                channel_mix: 'Channel Mix (Online vs Offline)',
                
                finance_overview: 'Collection Overview',
                rebate_progress: 'Rebate Progress',
                sku_risk: 'Slow Moving SKUs',
                compliance_alert: 'Compliance Risks',

                gmv: 'GMV',
                shipment: 'Shipment',
                amount: 'Amount',
                count: 'Count',
                view_detail: 'View Detail',

                Retailer: 'Retailer',
                Distributor: 'Distributor',
                'Online Seller': 'Online Seller',
                Wholesaler: 'Wholesaler',
                Active: 'Active',
                'Pending Audit': 'Pending Audit',
                Low: 'Low',
                Medium: 'Medium',
                High: 'High',
                VIP: 'VIP',
                KA: 'KA',
                Normal: 'Normal',
                
                aiEmailTitle: '‚ú® AI Email Assistant',
                aiAnalysisTitle: '‚ú® AI Inventory Analysis',
                thinking: 'Thinking...',
                close: 'Close',
                rewrite: 'Rewrite',
                confirmCopy: 'Copy',
                email_new: 'New Arrival',
                email_pay: 'Payment',
                email_greet: 'Greeting'
            }
        };

        // --- Mock Data ---
        const MOCK_DEALERS = [
            { id: 'D001', name: 'EuroStyle Boutique', country: 'Germany', region: 'EU', type: 'Retailer', level: 'KA', status: 'Active', contact: 'Hans M√ºller', phone: '+49 151 1234567', balance: '‚Ç¨12,500.00', risk: 'Low', stores: 5, lang: 'German' },
            { id: 'D002', name: 'Tokyo Trends Ltd.', country: 'Japan', region: 'APAC', type: 'Distributor', level: 'VIP', status: 'Active', contact: 'Kenji Sato', phone: '+81 90 1234 5678', balance: '¬•1,200,000', risk: 'Low', stores: 12, lang: 'Japanese' },
            { id: 'D003', name: 'Sydney Surf & Wear', country: 'Australia', region: 'Oceania', type: 'Online Seller', level: 'Normal', status: 'Pending Audit', contact: 'Sarah Jenkins', phone: '+61 400 123 456', balance: '$0.00', risk: 'Medium', stores: 1, lang: 'English' },
            { id: 'D004', name: 'Nordic Fashion Hub', country: 'Sweden', region: 'EU', type: 'Wholesaler', level: 'KA', status: 'Active', contact: 'Erik Larson', phone: '+46 70 123 4567', balance: '‚Ç¨45,200.00', risk: 'Low', stores: 0, lang: 'Swedish/English' },
        ];

        const MOCK_ORDERS = [
            { id: 'ORD-2023-001', dealer: 'EuroStyle Boutique', date: '2023-10-25', amount: '‚Ç¨4,500', status: 'Shipped', warehouse: 'EU-Hamburg' },
            { id: 'ORD-2023-002', dealer: 'Tokyo Trends Ltd.', date: '2023-10-26', amount: '¬•850,000', status: 'Processing', warehouse: 'CN-Shenzhen' },
            { id: 'ORD-2023-003', dealer: 'Nordic Fashion Hub', date: '2023-10-27', amount: '‚Ç¨12,000', status: 'Pending Approval', warehouse: 'EU-Hamburg' },
            { id: 'ORD-2023-004', dealer: 'EuroStyle Boutique', date: '2023-10-28', amount: '‚Ç¨1,200', status: 'Delivered', warehouse: 'EU-Hamburg' },
        ];

        const MOCK_PRODUCTS = [
            { id: 'SKU-001', name: 'Premium Leather Jacket', category: 'Apparel', stockCN: 500, stockUS: 120, stockEU: 200, price: '$120.00' },
            { id: 'SKU-002', name: 'Urban Canvas Sneakers', category: 'Footwear', stockCN: 1200, stockUS: 450, stockEU: 600, price: '$45.00' },
            { id: 'SKU-003', name: 'Silk Scarf Summer Edition', category: 'Accessories', stockCN: 300, stockUS: 50, stockEU: 80, price: '$25.00' },
            { id: 'SKU-004', name: 'Slim Fit Denim Jeans', category: 'Apparel', stockCN: 800, stockUS: 300, stockEU: 150, price: '$55.00' },
        ];

        const MOCK_SALES_DATA = [
            { name: 'Jan', EU: 4000, APAC: 2400, NA: 2400 },
            { name: 'Feb', EU: 3000, APAC: 1398, NA: 2210 },
            { name: 'Mar', EU: 2000, APAC: 9800, NA: 2290 },
            { name: 'Apr', EU: 2780, APAC: 3908, NA: 2000 },
            { name: 'May', EU: 1890, APAC: 4800, NA: 2181 },
            { name: 'Jun', EU: 2390, APAC: 3800, NA: 2500 },
            { name: 'Jul', EU: 3490, APAC: 4300, NA: 2100 },
        ];

        // --- Reusable AI Modal Component ---
        const AIModal = ({ isOpen, onClose, title, content, isLoading, actions, t }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fade-in">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[85vh] flex flex-col overflow-hidden animate-scale-in">
                        <div className="p-4 border-b border-purple-100 bg-gradient-to-r from-purple-50 to-white flex justify-between items-center">
                            <div className="flex items-center gap-2 text-purple-700">
                                <Sparkles size={20} className={isLoading ? "animate-pulse" : ""} />
                                <h3 className="font-bold text-lg">{title}</h3>
                            </div>
                            <button onClick={onClose} className="text-gray-400 hover:text-gray-600 hover:bg-gray-100 p-1 rounded-full transition-colors"><X size={20} /></button>
                        </div>
                        <div className="p-6 overflow-y-auto flex-1 bg-slate-50">
                            {isLoading ? (
                                <div className="flex flex-col items-center justify-center py-12 space-y-4">
                                    <Loader2 size={40} className="text-purple-600 animate-spin" />
                                    <p className="text-gray-500 font-medium animate-pulse">{t('thinking')}</p>
                                </div>
                            ) : (
                                <div className="prose prose-sm max-w-none text-gray-700 whitespace-pre-wrap leading-relaxed">{content}</div>
                            )}
                        </div>
                        {actions && !isLoading && <div className="p-4 border-t border-gray-100 bg-white flex justify-end gap-3">{actions}</div>}
                    </div>
                </div>
            );
        };

        // --- Sidebar ---
        const Sidebar = ({ activeTab, setActiveTab, t }) => {
            const menuItems = [
                { id: 'dashboard', label: t('dashboard'), icon: LayoutDashboard },
                { id: 'dealers', label: t('dealers'), icon: Users },
                { id: 'orders', label: t('orders'), icon: ShoppingCart },
                { id: 'products', label: t('products'), icon: Package },
                { id: 'finance', label: t('finance'), icon: Wallet },
                { id: 'analysis', label: t('analysis'), icon: BarChart3 },
                { id: 'settings', label: t('settings'), icon: Settings },
            ];
            return (
                <div className="w-64 bg-slate-900 text-white flex flex-col h-screen fixed left-0 top-0 z-20 shadow-xl">
                    <div className="p-6 flex items-center gap-3 border-b border-slate-800">
                        <div className="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center font-bold text-lg">G</div>
                        <span className="text-xl font-bold tracking-tight">Global CRM</span>
                    </div>
                    <div className="flex-1 py-6 space-y-1">
                        {menuItems.map((item) => (
                            <button key={item.id} onClick={() => setActiveTab(item.id)} className={`w-full flex items-center gap-3 px-6 py-3 transition-colors ${activeTab === item.id ? 'bg-blue-600 text-white border-r-4 border-blue-300' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
                                <item.icon size={20} />
                                <span className="font-medium">{item.label}</span>
                            </button>
                        ))}
                    </div>
                    <div className="p-6 border-t border-slate-800">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center"><span className="text-sm font-bold">AD</span></div>
                            <div><p className="text-sm font-medium">{t('adminUser')}</p><p className="text-xs text-slate-500">{t('globalManager')}</p></div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Header ---
        const Header = ({ title, lang, setLang, t }) => {
            const [isLangMenuOpen, setIsLangMenuOpen] = useState(false);
            const langMenuRef = useRef(null);
            useEffect(() => {
                const handleClickOutside = (event) => { if (langMenuRef.current && !langMenuRef.current.contains(event.target)) setIsLangMenuOpen(false); };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);
            return (
                <header className="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-8 sticky top-0 z-10">
                    <h1 className="text-2xl font-bold text-gray-800">{title}</h1>
                    <div className="flex items-center gap-6">
                        <div className="relative">
                            <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" size={18} />
                            <input type="text" placeholder={t('searchPlaceholder')} className="pl-10 pr-4 py-2 border border-gray-200 rounded-full text-sm w-64 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50"/>
                        </div>
                        <div className="relative" ref={langMenuRef}>
                            <button onClick={() => setIsLangMenuOpen(!isLangMenuOpen)} className="flex items-center gap-2 px-3 py-1.5 rounded-full hover:bg-gray-100 text-gray-600 text-sm font-medium transition-colors border border-transparent hover:border-gray-200">
                                <Languages size={18} /><span>{lang === 'zh' ? '‰∏≠Êñá' : 'English'}</span><ChevronDown size={14} className={`transition-transform ${isLangMenuOpen ? 'rotate-180' : ''}`} />
                            </button>
                            {isLangMenuOpen && (
                                <div className="absolute right-0 top-full mt-2 w-32 bg-white border border-gray-100 shadow-lg rounded-lg overflow-hidden p-1 z-50 animate-scale-in origin-top-right">
                                    <button onClick={() => { setLang('zh'); setIsLangMenuOpen(false); }} className={`w-full text-left px-3 py-2 text-sm rounded-md transition-colors ${lang === 'zh' ? 'bg-blue-50 text-blue-600' : 'hover:bg-gray-50 text-gray-700'}`}>üá®üá≥ ‰∏≠Êñá</button>
                                    <button onClick={() => { setLang('en'); setIsLangMenuOpen(false); }} className={`w-full text-left px-3 py-2 text-sm rounded-md transition-colors ${lang === 'en' ? 'bg-blue-50 text-blue-600' : 'hover:bg-gray-50 text-gray-700'}`}>üá∫üá∏ English</button>
                                </div>
                            )}
                        </div>
                        <button className="relative p-2 text-gray-500 hover:bg-gray-100 rounded-full"><Bell size={20} /><span className="absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white"></span></button>
                    </div>
                </header>
            );
        };

        // --- SUB-COMPONENTS FOR DASHBOARD (Defined outside to prevent re-renders) ---
        
        // 1. Overview Tab
        const OverviewTab = ({ t }) => {
            // State for GMV
            const [gmvPeriod, setGmvPeriod] = useState('Month');
            const [isGmvMenuOpen, setIsGmvMenuOpen] = useState(false);
            const gmvRef = useRef(null);

            // State for Shipment
            const [isShipmentBreakdownOpen, setIsShipmentBreakdownOpen] = useState(false);

            // State for Active Dealers
            const [isActiveDealersOpen, setIsActiveDealersOpen] = useState(false);

            // State for Dormant Dealers
            const [isDormantDealersOpen, setIsDormantDealersOpen] = useState(false);

            // Close GMV menu on outside click
            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (gmvRef.current && !gmvRef.current.contains(event.target)) {
                        setIsGmvMenuOpen(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            const gmvData = {
                'Month': { value: '$1.2M', sub: 'YTD: $8.5M', trend: '+12.5%' },
                'Quarter': { value: '$3.4M', sub: 'YTD: $8.5M', trend: '+8.2%' },
                'Year': { value: '$12.8M', sub: 'Target: $15M', trend: '+15.4%' }
            };

            const supplierShipmentData = [
                { name: 'Foxconn (CN)', value: 15200 },
                { name: 'Pegatron (VN)', value: 12000 },
                { name: 'Luxshare (CN)', value: 8500 },
                { name: 'Flex (US)', value: 5500 },
                { name: 'Jabil (MX)', value: 4000 },
            ];

            const activeDealersList = [
                { name: 'EuroStyle Boutique', lastOrder: '2 days ago' },
                { name: 'Tokyo Trends Ltd.', lastOrder: '5 days ago' },
                { name: 'Nordic Fashion Hub', lastOrder: '1 week ago' },
                { name: 'Seoul Style', lastOrder: '1 week ago' },
                { name: 'Sydney Surf', lastOrder: '2 weeks ago' }
            ];

            const dormantDealersList = [
                { name: 'Old London Shop', lastOrder: '6 months ago' },
                { name: 'Berlin Basics', lastOrder: '8 months ago' },
                { name: 'Parisian Chic', lastOrder: '1 year ago' }
            ];

            return (
                <div className="space-y-6 animate-fade-in">
                    {/* Top Stats Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                        
                        {/* Interactive GMV Card */}
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 relative">
                            <div className="flex justify-between items-start mb-2">
                                <div className="p-3 rounded-lg bg-green-50 text-green-600"><Wallet size={24} /></div>
                                <div className="relative" ref={gmvRef}>
                                    <button onClick={() => setIsGmvMenuOpen(!isGmvMenuOpen)} className="p-1 hover:bg-gray-100 rounded-full transition-colors">
                                        <MoreHorizontal size={16} className="text-gray-400" />
                                    </button>
                                    {isGmvMenuOpen && (
                                        <div className="absolute right-0 top-full mt-2 w-32 bg-white border border-gray-100 shadow-lg rounded-lg overflow-hidden z-20 animate-scale-in">
                                            {['Month', 'Quarter', 'Year'].map(p => (
                                                <button 
                                                    key={p} 
                                                    onClick={() => { setGmvPeriod(p); setIsGmvMenuOpen(false); }}
                                                    className={`w-full text-left px-3 py-2 text-xs hover:bg-gray-50 ${gmvPeriod === p ? 'text-blue-600 font-bold' : 'text-gray-700'}`}
                                                >
                                                    Êú¨{p === 'Month' ? 'Êúà' : p === 'Quarter' ? 'Â≠£' : 'Âπ¥'} GMV
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                            <h3 className="text-gray-500 text-sm font-medium">{t('gmv')} ({gmvPeriod === 'Month' ? 'Êú¨Êúà' : gmvPeriod === 'Quarter' ? 'Êú¨Â≠£' : 'Êú¨Âπ¥'})</h3>
                            <p className="text-2xl font-bold text-gray-800 mt-1">{gmvData[gmvPeriod].value}</p>
                            <span className="text-xs font-semibold text-green-600">{gmvData[gmvPeriod].trend}</span>
                        </div>

                        {/* Interactive Shipment Card */}
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 relative group">
                            <div className="flex justify-between items-start mb-2">
                                <div className="p-3 rounded-lg bg-blue-50 text-blue-600"><Package size={24} /></div>
                                <button onClick={() => setIsShipmentBreakdownOpen(!isShipmentBreakdownOpen)} className="p-1 hover:bg-gray-100 rounded-full transition-colors">
                                    <List size={16} className="text-gray-400" />
                                </button>
                            </div>
                            <h3 className="text-gray-500 text-sm font-medium">{t('shipment')}</h3>
                            <p className="text-2xl font-bold text-gray-800 mt-1">45,200</p>
                            <span className="text-xs font-semibold text-blue-600">+12% MoM</span>

                            {/* Shipment Breakdown Overlay */}
                            {isShipmentBreakdownOpen && (
                                <div className="absolute inset-0 bg-white z-10 rounded-xl p-4 border border-gray-200 shadow-sm flex flex-col animate-scale-in">
                                    <div className="flex justify-between items-center mb-2 border-b border-gray-100 pb-2">
                                        <span className="text-xs font-bold text-gray-700">‰æõÂ∫îÂïÜÂá∫Ë¥ßÊéíË°å</span>
                                        <button onClick={() => setIsShipmentBreakdownOpen(false)} className="text-gray-400 hover:text-gray-600"><X size={14}/></button>
                                    </div>
                                    <div className="flex-1 overflow-y-auto space-y-2 pr-1">
                                        {supplierShipmentData.map((s, i) => (
                                            <div key={i} className="flex justify-between items-center">
                                                <div className="flex items-center gap-2">
                                                    <span className="w-4 h-4 rounded-full bg-gray-100 text-[10px] flex items-center justify-center text-gray-600">{i+1}</span>
                                                    <span className="text-xs text-gray-600 truncate max-w-[80px]">{s.name}</span>
                                                </div>
                                                <span className="text-xs font-bold text-gray-800">{s.value.toLocaleString()}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Interactive Active Dealers Card */}
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 relative group">
                            <div className="flex justify-between items-start mb-2">
                                <div className="p-3 rounded-lg bg-purple-50 text-purple-600"><Users size={24} /></div>
                                <button onClick={() => setIsActiveDealersOpen(!isActiveDealersOpen)} className="p-1 hover:bg-gray-100 rounded-full transition-colors">
                                    <List size={16} className="text-gray-400" />
                                </button>
                            </div>
                            <h3 className="text-gray-500 text-sm font-medium">{t('activeDealers')}</h3>
                            <p className="text-2xl font-bold text-gray-800 mt-1">142</p>
                            <span className="text-xs font-semibold text-purple-600">New: +4</span>

                            {isActiveDealersOpen && (
                                <div className="absolute inset-0 bg-white z-10 rounded-xl p-4 border border-gray-200 shadow-sm flex flex-col animate-scale-in">
                                    <div className="flex justify-between items-center mb-2 border-b border-gray-100 pb-2">
                                        <span className="text-xs font-bold text-gray-700">Ê¥ªË∑ÉÁªèÈîÄÂïÜÊòéÁªÜ</span>
                                        <button onClick={() => setIsActiveDealersOpen(false)} className="text-gray-400 hover:text-gray-600"><X size={14}/></button>
                                    </div>
                                    <div className="flex-1 overflow-y-auto space-y-2 pr-1">
                                        {activeDealersList.map((d, i) => (
                                            <div key={i} className="flex justify-between items-center">
                                                <span className="text-xs text-gray-600 truncate">{d.name}</span>
                                                <span className="text-xs text-gray-400">{d.lastOrder}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Interactive Stock Dealers Card (Formerly Dormant Dealers/Alerts) */}
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 relative group">
                            <div className="flex justify-between items-start mb-2">
                                <div className="p-3 rounded-lg bg-indigo-50 text-indigo-600"><Database size={24} /></div>
                                <button onClick={() => setIsDormantDealersOpen(!isDormantDealersOpen)} className="p-1 hover:bg-gray-100 rounded-full transition-colors">
                                    <List size={16} className="text-gray-400" />
                                </button>
                            </div>
                            <h3 className="text-gray-500 text-sm font-medium">{t('dormantDealers')}</h3>
                            <p className="text-2xl font-bold text-gray-800 mt-1">35</p>
                            {/* Risk removed */}

                            {isDormantDealersOpen && (
                                <div className="absolute inset-0 bg-white z-10 rounded-xl p-4 border border-gray-200 shadow-sm flex flex-col animate-scale-in">
                                    <div className="flex justify-between items-center mb-2 border-b border-gray-100 pb-2">
                                        <span className="text-xs font-bold text-gray-700">Â≠òÈáèÁªèÈîÄÂïÜ (ÈïøÊúü‰∏çÊ¥ªË∑É)</span>
                                        <button onClick={() => setIsDormantDealersOpen(false)} className="text-gray-400 hover:text-gray-600"><X size={14}/></button>
                                    </div>
                                    <div className="flex-1 overflow-y-auto space-y-2 pr-1">
                                        {dormantDealersList.map((d, i) => (
                                            <div key={i} className="flex justify-between items-center">
                                                <span className="text-xs text-gray-600 truncate">{d.name}</span>
                                                <span className="text-xs text-red-400">{d.lastOrder}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        {/* GMV Trend Chart */}
                        <div className="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <h3 className="text-lg font-bold text-gray-800 mb-6">{t('gmv_trend')}</h3>
                            <div className="h-80 w-full">
                                {RechartsObj.ComposedChart ? (
                                    <ResponsiveContainer width="100%" height="100%">
                                        <ComposedChart data={MOCK_GMV_TREND}>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                            <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fill: '#64748b', fontSize: 12}} dy={10} />
                                            <YAxis yAxisId="left" axisLine={false} tickLine={false} tick={{fill: '#64748b', fontSize: 12}} />
                                            <YAxis yAxisId="right" orientation="right" axisLine={false} tickLine={false} tick={{fill: '#64748b', fontSize: 12}} />
                                            <Tooltip contentStyle={{borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'}} />
                                            <Legend />
                                            <Bar yAxisId="right" dataKey="shipment" fill="#e0e7ff" radius={[4, 4, 0, 0]} name={t('shipment')} />
                                            <Line yAxisId="left" type="monotone" dataKey="gmv" stroke="#3b82f6" strokeWidth={3} dot={{r: 4}} name={t('gmv')} />
                                        </ComposedChart>
                                    </ResponsiveContainer>
                                ) : <div className="flex h-full items-center justify-center text-gray-400">Chart Loading...</div>}
                            </div>
                        </div>

                        {/* Top Dealers List */}
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <h3 className="text-lg font-bold text-gray-800 mb-4">{t('top_dealers')}</h3>
                            <div className="space-y-4 overflow-y-auto max-h-80">
                                {MOCK_DEALERS.slice(0, 5).map((d, i) => (
                                    <div key={d.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                                        <div className="flex items-center gap-3">
                                            <span className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${i === 0 ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-200 text-gray-600'}`}>{i + 1}</span>
                                            <div>
                                                <p className="text-sm font-semibold text-gray-800">{d.name}</p>
                                                <p className="text-xs text-gray-500">{d.country}</p>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <p className="text-sm font-bold text-blue-600">{d.balance}</p>
                                            <p className="text-xs text-green-600 font-medium">Top 5%</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* Regional Map Placeholder (Using BarChart for Simplicity) */}
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <h3 className="text-lg font-bold text-gray-800 mb-6">{t('regional_map')}</h3>
                            <div className="h-64 w-full">
                                <ResponsiveContainer width="100%" height="100%">
                                    <BarChart layout="vertical" data={MOCK_REGIONAL_DATA}>
                                        <CartesianGrid strokeDasharray="3 3" horizontal={true} vertical={false} />
                                        <XAxis type="number" hide />
                                        <YAxis dataKey="name" type="category" width={80} tick={{fontSize: 12}} />
                                        <Tooltip />
                                        <Bar dataKey="value" fill="#8b5cf6" radius={[0, 4, 4, 0]} barSize={20} />
                                    </BarChart>
                                </ResponsiveContainer>
                            </div>
                        </div>

                        {/* Notifications */}
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <h3 className="text-lg font-bold text-gray-800 mb-6">{t('notifications')}</h3>
                            <div className="space-y-3">
                                {MOCK_NOTIFICATIONS.map((n, i) => (
                                    <div key={i} className="flex items-start gap-3 p-3 border-l-4 border-l-red-500 bg-red-50/50 rounded-r-lg">
                                        <div className="mt-1 text-red-500"><AlertCircle size={16} /></div>
                                        <div className="flex-1">
                                            <p className="text-sm font-medium text-gray-800">{n.title}</p>
                                            <p className="text-xs text-gray-500 mt-1">{n.time} ago ‚Ä¢ {n.type.toUpperCase()}</p>
                                        </div>
                                        <button className="text-xs text-blue-600 font-medium hover:underline">{t('view_detail')}</button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 2. Supply Chain Tab
        const SupplyChainTab = ({ t }) => (
            <div className="space-y-6 animate-fade-in">
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    {/* Inventory Distribution */}
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 className="text-lg font-bold text-gray-800 mb-2">{t('inventory_status')}</h3>
                        <div className="h-64 w-full">
                            <ResponsiveContainer width="100%" height="100%">
                                <PieChart>
                                    <Pie data={MOCK_INVENTORY_KPI} innerRadius={60} outerRadius={80} paddingAngle={5} dataKey="value">
                                        {MOCK_INVENTORY_KPI.map((entry, index) => (
                                            <Cell key={`cell-${index}`} fill={entry.color} />
                                        ))}
                                    </Pie>
                                    <Tooltip />
                                    <Legend verticalAlign="bottom" height={36}/>
                                </PieChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    {/* Order Processing Status */}
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 md:col-span-2">
                        <h3 className="text-lg font-bold text-gray-800 mb-6">{t('order_funnel')}</h3>
                        <div className="grid grid-cols-4 gap-4 text-center">
                            {[{l:'Pending Review', v:24, c:'bg-gray-100 text-gray-600'}, {l:'Processing', v:156, c:'bg-blue-100 text-blue-600'}, {l:'In Transit', v:89, c:'bg-purple-100 text-purple-600'}, {l:'Exception', v:3, c:'bg-red-100 text-red-600'}].map((item, i) => (
                                <div key={i} className={`p-4 rounded-xl ${item.c} flex flex-col items-center justify-center h-32`}>
                                    <span className="text-3xl font-bold mb-2">{item.v}</span>
                                    <span className="text-xs font-medium uppercase tracking-wide">{item.l}</span>
                                </div>
                            ))}
                        </div>
                        <div className="mt-6">
                            <h4 className="text-sm font-semibold text-gray-700 mb-3">{t('logistics_anomaly')}</h4>
                            <div className="bg-orange-50 border border-orange-200 rounded-lg p-3 flex items-center justify-between">
                                <span className="text-sm text-orange-800 flex items-center gap-2"><Truck size={16}/> Order #9921 - Delayed at Customs (US)</span>
                                <span className="text-xs font-bold text-orange-600">Action Required</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        // 3. Dealer & Product Tab
        const DealerTab = ({ t }) => (
            <div className="space-y-6 animate-fade-in">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 className="text-lg font-bold text-gray-800 mb-6">{t('lifecycle_funnel')}</h3>
                        <div className="h-64 w-full">
                            <ResponsiveContainer width="100%" height="100%">
                                <BarChart layout="vertical" data={MOCK_LIFECYCLE_DATA} barCategoryGap={10}>
                                    <CartesianGrid strokeDasharray="3 3" horizontal={true} vertical={false} />
                                    <XAxis type="number" hide />
                                    <YAxis dataKey="name" type="category" width={100} tick={{fontSize: 12}} />
                                    <Tooltip />
                                    <Bar dataKey="value" fill="#3b82f6" radius={[0, 4, 4, 0]} barSize={24} />
                                </BarChart>
                            </ResponsiveContainer>
                        </div>
                    </div>
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 className="text-lg font-bold text-gray-800 mb-6">{t('channel_mix')}</h3>
                        <div className="space-y-6">
                            <div>
                                <div className="flex justify-between text-sm mb-1"><span>E-Commerce (Shopify/Amazon)</span><span className="font-bold">65%</span></div>
                                <div className="w-full bg-gray-100 rounded-full h-2.5"><div className="bg-purple-600 h-2.5 rounded-full" style={{width: '65%'}}></div></div>
                            </div>
                            <div>
                                <div className="flex justify-between text-sm mb-1"><span>Offline Retail</span><span className="font-bold">25%</span></div>
                                <div className="w-full bg-gray-100 rounded-full h-2.5"><div className="bg-blue-500 h-2.5 rounded-full" style={{width: '25%'}}></div></div>
                            </div>
                            <div>
                                <div className="flex justify-between text-sm mb-1"><span>Wholesale</span><span className="font-bold">10%</span></div>
                                <div className="w-full bg-gray-100 rounded-full h-2.5"><div className="bg-green-500 h-2.5 rounded-full" style={{width: '10%'}}></div></div>
                            </div>
                        </div>
                        <div className="mt-8 pt-6 border-t border-gray-100">
                            <h4 className="text-sm font-bold text-gray-800 mb-3">{t('sales_upload')}</h4>
                            <div className="flex items-center justify-between text-sm">
                                <span className="text-gray-600">Êú¨ÊúàÂ∑≤‰∏ä‰º†Êï∞ÊçÆÁªèÈîÄÂïÜ:</span>
                                <span className="font-bold text-green-600">82 / 142</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        // 4. Finance & Risk Tab
        const RiskTab = ({ t }) => (
            <div className="space-y-6 animate-fade-in">
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 col-span-2">
                        <h3 className="text-lg font-bold text-gray-800 mb-6">{t('finance_overview')}</h3>
                        <div className="grid grid-cols-3 gap-6 mb-6">
                            <div className="bg-gray-50 p-4 rounded-lg">
                                <p className="text-xs text-gray-500 uppercase">Received (This Month)</p>
                                <p className="text-xl font-bold text-gray-800 mt-1">$450,000</p>
                            </div>
                            <div className="bg-gray-50 p-4 rounded-lg">
                                <p className="text-xs text-gray-500 uppercase">Pending</p>
                                <p className="text-xl font-bold text-gray-800 mt-1">$120,000</p>
                            </div>
                            <div className="bg-red-50 p-4 rounded-lg border border-red-100">
                                <p className="text-xs text-red-600 uppercase">Overdue (>30 Days)</p>
                                <p className="text-xl font-bold text-red-700 mt-1">$15,000</p>
                            </div>
                        </div>
                        <div>
                            <h4 className="text-sm font-bold text-gray-700 mb-2">{t('rebate_progress')}</h4>
                            <div className="w-full bg-gray-100 rounded-full h-4"><div className="bg-gradient-to-r from-green-400 to-blue-500 h-4 rounded-full" style={{width: '72%'}}></div></div>
                            <p className="text-xs text-right mt-1 text-gray-500">Annual Target: 72% Completed</p>
                        </div>
                    </div>
                    <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 className="text-lg font-bold text-gray-800 mb-6">{t('compliance_alert')}</h3>
                        <div className="space-y-4">
                            <div className="flex items-start gap-3">
                                <div className="mt-1 text-red-500"><AlertTriangle size={16}/></div>
                                <div>
                                    <p className="text-sm font-bold text-gray-800">Low Price Alert</p>
                                    <p className="text-xs text-gray-500">Dealer D002 selling SKU-001 below MAP.</p>
                                </div>
                            </div>
                            <div className="flex items-start gap-3">
                                <div className="mt-1 text-orange-500"><Globe size={16}/></div>
                                <div>
                                    <p className="text-sm font-bold text-gray-800">Cross-Region Sales</p>
                                    <p className="text-xs text-gray-500">EU Dealer detected selling in NA.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        // --- DASHBOARD VIEW (UPDATED) ---
        const DashboardView = ({ t }) => {
            const [subTab, setSubTab] = useState('overview');

            const TabButton = ({ id, label }) => (
                <button 
                    onClick={() => setSubTab(id)}
                    className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${
                        subTab === id 
                        ? 'bg-blue-600 text-white shadow-md' 
                        : 'bg-white text-gray-600 hover:bg-gray-50 border border-gray-200'
                    }`}
                >
                    {label}
                </button>
            );

            return (
                <div className="space-y-6">
                    {/* Notification Banner */}
                    <div className="bg-indigo-900 text-white px-6 py-3 rounded-xl flex items-center justify-between shadow-lg">
                        <div className="flex items-center gap-3">
                            <Bell className="animate-bounce" size={20} />
                            <span className="font-medium text-sm">3 Pending Dealer Approvals ‚Ä¢ 2 Low Stock Alerts ‚Ä¢ 1 Compliance Warning</span>
                        </div>
                        <button className="text-xs bg-indigo-700 px-3 py-1 rounded hover:bg-indigo-600 transition-colors">Process Now</button>
                    </div>

                    {/* Sub-tabs Navigation */}
                    <div className="flex gap-3 border-b border-gray-200 pb-1">
                        <TabButton id="overview" label={t('tab_overview')} />
                        <TabButton id="supply" label={t('tab_supply')} />
                        <TabButton id="dealer" label={t('tab_dealer')} />
                        <TabButton id="risk" label={t('tab_risk')} />
                    </div>

                    {/* Tab Content */}
                    {subTab === 'overview' && <OverviewTab t={t} />}
                    {subTab === 'supply' && <SupplyChainTab t={t} />}
                    {subTab === 'dealer' && <DealerTab t={t} />}
                    {subTab === 'risk' && <RiskTab t={t} />}
                </div>
            );
        };

        // --- Dealers View ---
        const DealersView = ({ t, lang }) => {
            const [selectedDealer, setSelectedDealer] = useState(null);
            const [isEmailModalOpen, setIsEmailModalOpen] = useState(false);
            const [emailContent, setEmailContent] = useState("");
            const [isGeneratingEmail, setIsGeneratingEmail] = useState(false);
            
            // New state for AI Email dropdown menu to prevent flash back issues
            const [isEmailMenuOpen, setIsEmailMenuOpen] = useState(false);
            const emailMenuRef = useRef(null);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (emailMenuRef.current && !emailMenuRef.current.contains(event.target)) {
                        setIsEmailMenuOpen(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            const handleGenerateEmail = async (typeKey) => {
                setIsEmailMenuOpen(false); // Close menu on selection
                setIsEmailModalOpen(true);
                setIsGeneratingEmail(true);
                setEmailContent("");

                const typeLabel = t(typeKey);

                const prompt = `‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑË∑®Â¢ÉÁîµÂïÜÂÆ¢Êà∑ÁªèÁêÜ„ÄÇËØ∑‰∏∫Êàë‰ª¨ÁöÑÁªèÈîÄÂïÜÊí∞ÂÜô‰∏ÄÂ∞ÅÂïÜÂä°ÈÇÆ‰ª∂„ÄÇ
                
                ÁªèÈîÄÂïÜ‰ø°ÊÅØ:
                - ÂêçÁß∞: ${selectedDealer.name}
                - ÂõΩÂÆ∂: ${selectedDealer.country}
                - ËØ≠Ë®Ä: ${selectedDealer.lang}
                - ËÅîÁ≥ª‰∫∫: ${selectedDealer.contact}
                - Á∫ßÂà´: ${selectedDealer.level}
                
                ÈÇÆ‰ª∂‰∏ªÈ¢òÁ±ªÂûã: ${typeLabel}
                
                Ë¶ÅÊ±Ç:
                1. Áî®${selectedDealer.lang}Êí∞ÂÜôÊ≠£ÊñáÔºàÂ¶ÇÊûú‰∏çÊòØËã±ËØ≠ÔºåËØ∑Âú®‰∏ãÊñπÈôÑ‰∏äÁøªËØëÔºâ„ÄÇ
                2. ËØ≠Ê∞î‰∏ì‰∏ö„ÄÅ‰∫≤Âàá„ÄÅÂæó‰Ωì„ÄÇ
                3. Ê†πÊçÆ‰∏ªÈ¢òÁ±ªÂûãËá™Âä®Â°´ÂÖÖÂêàÈÄÇÁöÑÂÜÖÂÆπ„ÄÇ
                4. Ê†ºÂºèÂåÖÂê´ÔºöÈÇÆ‰ª∂‰∏ªÈ¢ò„ÄÅÊ≠£Êñá„ÄÇ
                5. UIËØ≠Ë®ÄÊòØ${lang === 'zh' ? '‰∏≠Êñá' : 'English'}ÔºåËØ∑Ê†πÊçÆÊÉÖÂÜµË∞ÉÊï¥‰Ω†ÁöÑËß£ÈáäÊÄßËØ≠Ë®Ä(Â¶ÇÊûúÊúâÁöÑËØù)„ÄÇ`;

                const result = await callGemini(prompt);
                setEmailContent(result);
                setIsGeneratingEmail(false);
            };

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center bg-white p-4 rounded-xl border border-gray-200 shadow-sm">
                        <div className="flex gap-4">
                            <div className="relative">
                                <Filter className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" size={16} />
                                <select className="pl-10 pr-8 py-2 border border-gray-200 rounded-lg text-sm bg-gray-50 focus:outline-none hover:bg-white transition-colors">
                                    <option>{t('allRegions')}</option>
                                    <option>EU (Europe)</option>
                                    <option>APAC (Asia Pacific)</option>
                                    <option>NA (North America)</option>
                                </select>
                            </div>
                            <div className="relative">
                                <select className="pl-4 pr-8 py-2 border border-gray-200 rounded-lg text-sm bg-gray-50 focus:outline-none hover:bg-white transition-colors">
                                    <option>{t('allLevels')}</option>
                                    <option>{t('VIP')}</option>
                                    <option>{t('KA')}</option>
                                    <option>{t('Normal')}</option>
                                </select>
                            </div>
                        </div>
                        <button className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors">
                            <Plus size={16} />
                            {t('newDealer')}
                        </button>
                    </div>

                    <div className="flex gap-6 items-start">
                        <div className={`${selectedDealer ? 'w-1/2' : 'w-full'} transition-all duration-300`}>
                            <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                                <table className="w-full text-left text-sm">
                                    <thead className="bg-gray-50 border-b border-gray-200 text-gray-500">
                                        <tr>
                                            <th className="p-4 font-medium">{t('dealerName')}</th>
                                            <th className="p-4 font-medium">{t('country')}</th>
                                            <th className="p-4 font-medium">{t('type')}</th>
                                            <th className="p-4 font-medium">{t('level')}</th>
                                            <th className="p-4 font-medium">{t('status')}</th>
                                            <th className="p-4 font-medium text-right">{t('action')}</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-100">
                                        {MOCK_DEALERS.map((dealer) => (
                                            <tr 
                                                key={dealer.id} 
                                                onClick={() => setSelectedDealer(dealer)}
                                                className={`hover:bg-blue-50 cursor-pointer transition-colors ${selectedDealer?.id === dealer.id ? 'bg-blue-50' : ''}`}
                                            >
                                                <td className="p-4 font-medium text-gray-800">{dealer.name}</td>
                                                <td className="p-4 text-gray-600 flex items-center gap-2">
                                                    <Globe size={14} className="text-gray-400"/> {dealer.country}
                                                </td>
                                                <td className="p-4 text-gray-600">{t(dealer.type)}</td>
                                                <td className="p-4">
                                                    <span className={`px-2 py-1 rounded text-xs font-bold ${
                                                        dealer.level === 'VIP' ? 'bg-purple-100 text-purple-700' :
                                                        dealer.level === 'KA' ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-700'
                                                    }`}>{t(dealer.level)}</span>
                                                </td>
                                                <td className="p-4">
                                                    <span className={`flex items-center gap-1.5 text-xs font-medium ${
                                                        dealer.status === 'Active' ? 'text-green-600' : 'text-amber-600'
                                                    }`}>
                                                        <div className={`w-1.5 h-1.5 rounded-full ${dealer.status === 'Active' ? 'bg-green-600' : 'bg-amber-600'}`} />
                                                        {dealer.status === 'Active' ? t('Active') : t('Pending Audit')}
                                                    </span>
                                                </td>
                                                <td className="p-4 text-right">
                                                    <button className="text-gray-400 hover:text-blue-600"><MoreHorizontal size={18}/></button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {selectedDealer && (
                            <div className="w-1/2 bg-white rounded-xl shadow-lg border border-gray-200 animate-slide-in-right relative">
                                <button 
                                    onClick={() => setSelectedDealer(null)}
                                    className="absolute top-4 right-4 text-gray-400 hover:text-gray-600"
                                >
                                    <X size={20} />
                                </button>
                                <div className="p-6 border-b border-gray-100">
                                    <div className="flex items-center gap-3 mb-2">
                                        <div className="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center text-xl">üè¢</div>
                                        <div>
                                            <h2 className="text-xl font-bold text-gray-800">{selectedDealer.name}</h2>
                                            <p className="text-sm text-gray-500">ID: {selectedDealer.id} ‚Ä¢ {selectedDealer.country} ‚Ä¢ {selectedDealer.lang}</p>
                                        </div>
                                    </div>
                                    <div className="flex gap-4 mt-4">
                                        <button className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg text-sm font-medium transition-colors">
                                            {t('createOrder')}
                                        </button>
                                        
                                        {/* FIXED: AI Email Button changed from CSS Hover to Click state to prevent flash back */}
                                        <div className="flex-1 relative" ref={emailMenuRef}>
                                            <button 
                                                onClick={() => setIsEmailMenuOpen(!isEmailMenuOpen)}
                                                className="w-full border border-purple-200 bg-purple-50 text-purple-700 hover:bg-purple-100 py-2 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2"
                                            >
                                                <Sparkles size={16} /> {t('aiEmail')}
                                            </button>
                                            {isEmailMenuOpen && (
                                                <div className="absolute top-full left-0 w-full mt-2 bg-white border border-gray-200 shadow-xl rounded-lg overflow-hidden z-20 animate-scale-in">
                                                    <button onClick={() => handleGenerateEmail("email_new")} className="w-full text-left px-4 py-2 text-sm hover:bg-gray-50 text-gray-700">{t('email_new')}</button>
                                                    <button onClick={() => handleGenerateEmail("email_pay")} className="w-full text-left px-4 py-2 text-sm hover:bg-gray-50 text-gray-700">{t('email_pay')}</button>
                                                    <button onClick={() => handleGenerateEmail("email_greet")} className="w-full text-left px-4 py-2 text-sm hover:bg-gray-50 text-gray-700">{t('email_greet')}</button>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="p-6 space-y-6 h-[calc(100vh-350px)] overflow-y-auto">
                                    <section>
                                        <h3 className="text-sm font-bold text-gray-900 uppercase tracking-wider mb-3">{t('basicInfo')}</h3>
                                        <div className="grid grid-cols-2 gap-4 text-sm">
                                            <div className="bg-gray-50 p-3 rounded-lg">
                                                <p className="text-gray-500 text-xs mb-1">{t('contact')}</p>
                                                <p className="font-medium text-gray-800">{selectedDealer.contact}</p>
                                            </div>
                                            <div className="bg-gray-50 p-3 rounded-lg">
                                                <p className="text-gray-500 text-xs mb-1">{t('phone')}</p>
                                                <p className="font-medium text-gray-800">{selectedDealer.phone}</p>
                                            </div>
                                            <div className="bg-gray-50 p-3 rounded-lg">
                                                <p className="text-gray-500 text-xs mb-1">{t('balance')}</p>
                                                <p className="font-medium text-gray-800">{selectedDealer.balance}</p>
                                            </div>
                                            <div className="bg-gray-50 p-3 rounded-lg">
                                                <p className="text-gray-500 text-xs mb-1">{t('risk')}</p>
                                                <p className={`font-medium ${selectedDealer.risk === 'Low' ? 'text-green-600' : 'text-amber-600'}`}>{t(selectedDealer.risk)}</p>
                                            </div>
                                        </div>
                                    </section>
                                    <section>
                                        <h3 className="text-sm font-bold text-gray-900 uppercase tracking-wider mb-3 flex items-center gap-2">
                                            <ShieldCheck size={16} /> {t('compliance')}
                                        </h3>
                                        <div className="border border-gray-200 rounded-lg p-4 space-y-3">
                                            <div className="flex justify-between items-center text-sm">
                                                <span className="text-gray-600">{t('license')}</span>
                                                <span className="text-green-600 flex items-center gap-1"><CheckCircle size={14}/> {t('verified')}</span>
                                            </div>
                                            <div className="flex justify-between items-center text-sm">
                                                <span className="text-gray-600">{t('vat')}</span>
                                                <span className="text-green-600 flex items-center gap-1"><CheckCircle size={14}/> DE123456789</span>
                                            </div>
                                            <div className="flex justify-between items-center text-sm">
                                                <span className="text-gray-600">{t('auth')}</span>
                                                <span className="text-blue-600 cursor-pointer hover:underline">{t('viewPdf')}</span>
                                            </div>
                                        </div>
                                    </section>
                                    <section>
                                        <h3 className="text-sm font-bold text-gray-900 uppercase tracking-wider mb-3 flex items-center gap-2">
                                            <Store size={16} /> {t('stores')} ({selectedDealer.stores})
                                        </h3>
                                        <div className="space-y-2">
                                            <div className="bg-white border border-gray-200 p-3 rounded-lg flex justify-between items-center hover:border-blue-300 transition-colors">
                                                <div className="flex items-center gap-3">
                                                    <div className="bg-blue-50 p-2 rounded text-blue-600"><Store size={16}/></div>
                                                    <div>
                                                        <p className="text-sm font-medium">Flagship Store - Berlin</p>
                                                        <p className="text-xs text-gray-500">Offline ‚Ä¢ Retail</p>
                                                    </div>
                                                </div>
                                                <span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">Normal</span>
                                            </div>
                                            <div className="bg-white border border-gray-200 p-3 rounded-lg flex justify-between items-center hover:border-blue-300 transition-colors">
                                                <div className="flex items-center gap-3">
                                                    <div className="bg-purple-50 p-2 rounded text-purple-600"><Globe size={16}/></div>
                                                    <div>
                                                        <p className="text-sm font-medium">Official Website (EU)</p>
                                                        <p className="text-xs text-gray-500">Online ‚Ä¢ Shopify</p>
                                                    </div>
                                                </div>
                                                <span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">Data Sync ON</span>
                                            </div>
                                        </div>
                                    </section>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    <AIModal 
                        isOpen={isEmailModalOpen}
                        onClose={() => setIsEmailModalOpen(false)}
                        title={t('aiEmailTitle')}
                        content={emailContent}
                        isLoading={isGeneratingEmail}
                        t={t}
                        actions={
                            <>
                                <button 
                                    className="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors"
                                    onClick={() => {
                                        setIsGeneratingEmail(true);
                                        handleGenerateEmail("Refine: Make it shorter");
                                    }}
                                >
                                    <RefreshCw size={14} className="inline mr-2"/> {t('rewrite')}
                                </button>
                                <button 
                                    className="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-2"
                                    onClick={() => {
                                        alert("Email sent to draft!");
                                        setIsEmailModalOpen(false);
                                    }}
                                >
                                    <Send size={14} /> {t('confirmCopy')}
                                </button>
                            </>
                        }
                    />
                </div>
            );
        };

        // --- Orders View ---
        const OrdersView = ({ t }) => (
            <div className="space-y-6">
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div className="bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex items-center gap-4">
                        <div className="bg-blue-100 p-3 rounded-full text-blue-600"><Package size={24}/></div>
                        <div>
                            <p className="text-sm text-gray-500">{t('pendingShip')}</p>
                            <p className="text-xl font-bold">12</p>
                        </div>
                    </div>
                    <div className="bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex items-center gap-4">
                        <div className="bg-amber-100 p-3 rounded-full text-amber-600"><FileText size={24}/></div>
                        <div>
                            <p className="text-sm text-gray-500">{t('toApprove')}</p>
                            <p className="text-xl font-bold">5</p>
                        </div>
                    </div>
                    <div className="bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex items-center gap-4">
                        <div className="bg-green-100 p-3 rounded-full text-green-600"><Truck size={24}/></div>
                        <div>
                            <p className="text-sm text-gray-500">{t('inTransit')}</p>
                            <p className="text-xl font-bold">34</p>
                        </div>
                    </div>
                </div>

                <div className="bg-white rounded-xl shadow-sm border border-gray-200">
                    <div className="p-4 border-b border-gray-200 flex justify-between items-center">
                        <h3 className="font-bold text-gray-800">{t('allOrders')}</h3>
                        <button className="text-blue-600 text-sm font-medium">{t('exportExcel')}</button>
                    </div>
                    <table className="w-full text-left text-sm">
                        <thead className="bg-gray-50 border-b border-gray-200 text-gray-500">
                            <tr>
                                <th className="p-4 font-medium">{t('orderId')}</th>
                                <th className="p-4 font-medium">{t('dealers')}</th>
                                <th className="p-4 font-medium">{t('warehouse')}</th>
                                <th className="p-4 font-medium">{t('amount')}</th>
                                <th className="p-4 font-medium">{t('date')}</th>
                                <th className="p-4 font-medium">{t('status')}</th>
                                <th className="p-4 font-medium text-right">{t('action')}</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-gray-100">
                            {MOCK_ORDERS.map((order) => (
                                <tr key={order.id} className="hover:bg-gray-50 transition-colors">
                                    <td className="p-4 font-medium text-blue-600 cursor-pointer">{order.id}</td>
                                    <td className="p-4 text-gray-800 font-medium">{order.dealer}</td>
                                    <td className="p-4 text-gray-500 flex items-center gap-1"><MapPin size={14}/> {order.warehouse}</td>
                                    <td className="p-4 text-gray-800 font-bold">{order.amount}</td>
                                    <td className="p-4 text-gray-500">{order.date}</td>
                                    <td className="p-4">
                                        <span className={`px-2 py-1 rounded-full text-xs font-bold ${
                                            order.status === 'Shipped' || order.status === 'Delivered' ? 'bg-green-100 text-green-700' :
                                            order.status === 'Processing' ? 'bg-blue-100 text-blue-700' : 'bg-amber-100 text-amber-700'
                                        }`}>
                                            {t(order.status)}
                                        </span>
                                    </td>
                                    <td className="p-4 text-right">
                                        <button className="text-gray-400 hover:text-blue-600">{t('manage')}</button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        // --- Products View ---
        const ProductsView = ({ t, lang }) => {
            const [isAnalysisModalOpen, setIsAnalysisModalOpen] = useState(false);
            const [analysisContent, setAnalysisContent] = useState("");
            const [isAnalyzing, setIsAnalyzing] = useState(false);

            const handleRunAnalysis = async () => {
                setIsAnalysisModalOpen(true);
                setIsAnalyzing(true);
                setAnalysisContent("");

                const productsContext = JSON.stringify(MOCK_PRODUCTS.map(p => ({
                    name: p.name,
                    stock_CN: p.stockCN,
                    stock_US: p.stockUS,
                    stock_EU: p.stockEU,
                    price: p.price
                })));

                const languageInstruction = lang === 'en' ? 'Answer in English.' : 'ËØ∑Áî®‰∏≠ÊñáÂõûÁ≠î„ÄÇ';

                const prompt = `‰Ωú‰∏∫‰æõÂ∫îÈìæÂíåÂ∫ìÂ≠òÁÆ°ÁêÜ‰∏ìÂÆ∂ÔºåËØ∑ÂàÜÊûê‰ª•‰∏ã‰∫ßÂìÅÊï∞ÊçÆÔºåÂπ∂ÁªôÂá∫Ë°•Ë¥ßÂª∫ËÆÆ„ÄÇ
                
                ‰∫ßÂìÅÊï∞ÊçÆ(JSON): ${productsContext}
                
                ÂàÜÊûêË¶ÅÊ±ÇÔºö
                1. ËØÜÂà´Â∫ìÂ≠ò‰Ωé‰∫é100ÁöÑÈ´òÈ£éÈô©‰∫ßÂìÅÔºàÊåâ‰ªìÂ∫ìÂå∫ÂüüÂàíÂàÜÔºâ„ÄÇ
                2. Âü∫‰∫éÂÅáËÆæÁöÑÈîÄÂîÆË∂ãÂäøÔºàÊØîÂ¶Ç US Â∏ÇÂú∫Â¢ûÈïøËøÖÈÄüÔºâÔºåÂª∫ËÆÆÂì™‰∫õ‰∫ßÂìÅÈúÄË¶ÅÁ¥ßÊÄ•‰ªé CN ‰ªìË∞ÉÊã®Âà∞ US Êàñ EU ‰ªì„ÄÇ
                3. ËæìÂá∫Ê†ºÂºè‰∏∫ÁªìÊûÑÂåñÁöÑÂª∫ËÆÆÂàóË°®Ôºö
                   - üî¥ Á¥ßÊÄ•Ë°•Ë¥ßÊèêÈÜí
                   - üü° Ë∞ÉÊã®Âª∫ËÆÆ
                   - üü¢ Â∫ìÂ≠òÂÅ•Â∫∑Ê¶ÇËßà
                4. ‰øùÊåÅÁÆÄÊ¥ÅÔºåÊï∞ÊçÆÈ©±Âä®„ÄÇ
                5. ${languageInstruction}`;

                const result = await callGemini(prompt);
                setAnalysisContent(result);
                setIsAnalyzing(false);
            };

            return (
                <div className="space-y-6">
                    <div className="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div className="p-4 border-b border-gray-200 flex justify-between items-center">
                            <div className="flex gap-4">
                                <h3 className="font-bold text-gray-800">{t('stockCenter')}</h3>
                                <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded items-center flex">{t('syncStatus')}</span>
                            </div>
                            <div className="flex gap-2">
                                <button className="border border-gray-300 px-3 py-1.5 rounded text-sm text-gray-600">{t('batchPrice')}</button>
                                <button 
                                    onClick={handleRunAnalysis}
                                    className="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-3 py-1.5 rounded text-sm flex items-center gap-2 transition-all shadow-md hover:shadow-lg"
                                >
                                    <Sparkles size={16} /> {t('aiRestock')}
                                </button>
                            </div>
                        </div>
                        
                        <div className="overflow-x-auto">
                            <table className="w-full text-left text-sm">
                                <thead className="bg-gray-50 border-b border-gray-200 text-gray-500">
                                    <tr>
                                        <th className="p-4 font-medium">{t('skuName')}</th>
                                        <th className="p-4 font-medium">{t('category')}</th>
                                        <th className="p-4 font-medium">{t('basePrice')}</th>
                                        <th className="p-4 font-medium text-center bg-blue-50/50">{t('stockCN')}</th>
                                        <th className="p-4 font-medium text-center bg-purple-50/50">{t('stockUS')}</th>
                                        <th className="p-4 font-medium text-center bg-green-50/50">{t('stockEU')}</th>
                                        <th className="p-4 font-medium text-right">{t('action')}</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-100">
                                    {MOCK_PRODUCTS.map((product) => (
                                        <tr key={product.id} className="hover:bg-gray-50 transition-colors">
                                            <td className="p-4">
                                                <div>
                                                    <p className="font-medium text-gray-800">{product.name}</p>
                                                    <p className="text-xs text-gray-400">{product.id}</p>
                                                </div>
                                            </td>
                                            <td className="p-4 text-gray-600">{t(product.category)}</td>
                                            <td className="p-4 font-bold text-gray-800">{product.price}</td>
                                            <td className="p-4 text-center bg-blue-50/20">
                                                <span className={`font-medium ${product.stockCN < 400 ? 'text-amber-600' : 'text-gray-700'}`}>
                                                    {product.stockCN}
                                                </span>
                                            </td>
                                            <td className="p-4 text-center bg-purple-50/20">
                                                <span className={`font-medium ${product.stockUS < 100 ? 'text-red-600 font-bold' : 'text-gray-700'}`}>
                                                    {product.stockUS}
                                                </span>
                                            </td>
                                            <td className="p-4 text-center bg-green-50/20">
                                                <span className="font-medium text-gray-700">{product.stockEU}</span>
                                            </td>
                                            <td className="p-4 text-right">
                                                <button className="text-blue-600 hover:underline">{t('setPrice')}</button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <AIModal 
                        isOpen={isAnalysisModalOpen}
                        onClose={() => setIsAnalysisModalOpen(false)}
                        title={t('aiAnalysisTitle')}
                        content={analysisContent}
                        isLoading={isAnalyzing}
                        t={t}
                        actions={
                            <button 
                                className="px-4 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium hover:bg-gray-800 transition-colors"
                                onClick={() => setIsAnalysisModalOpen(false)}
                            >
                                {t('close')}
                            </button>
                        }
                    />
                </div>
            );
        };

        // --- Main App ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [lang, setLang] = useState('zh');
            const [title, setTitle] = useState('');

            const t = (key) => TRANSLATIONS[lang][key] || key;

            useEffect(() => {
                switch(activeTab) {
                    case 'dashboard': setTitle(t('dashboard')); break;
                    case 'dealers': setTitle(t('dealers')); break;
                    case 'orders': setTitle(t('orders')); break;
                    case 'products': setTitle(t('products')); break;
                    case 'finance': setTitle(t('finance')); break;
                    default: setTitle('CRM System');
                }
            }, [activeTab, lang]);

            const renderContent = () => {
                switch (activeTab) {
                    case 'dashboard': return <DashboardView t={t} />;
                    case 'dealers': return <DealersView t={t} lang={lang} />;
                    case 'orders': return <OrdersView t={t} />;
                    case 'products': return <ProductsView t={t} lang={lang} />;
                    default: 
                        return (
                            <div className="flex flex-col items-center justify-center h-96 text-gray-400">
                                <Settings size={64} className="mb-4 text-gray-200" />
                                <p className="text-lg font-medium">ËØ•Ê®°ÂùóÊ≠£Âú®ÂºÄÂèë‰∏≠...</p>
                                <p className="text-sm">This module is under construction.</p>
                            </div>
                        );
                }
            };

            return (
                <div className="flex bg-gray-50 min-h-screen font-sans text-gray-900">
                    <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} t={t} />
                    
                    <main className="ml-64 flex-1 flex flex-col min-h-screen">
                        <Header title={title} lang={lang} setLang={setLang} t={t} />
                        
                        <div className="p-8 flex-1 overflow-y-auto">
                            {renderContent()}
                        </div>
                    </main>
                    
                    <div className="fixed bottom-8 right-8 bg-gray-900 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 animate-slide-in-up z-50">
                        <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        <span className="text-sm font-medium">System Online ‚Ä¢ AI Ready</span>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>